
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Strike | Cross-Platform</title>
    <style>
        :root { --primary: #00f2ff; --accent: #ff3c00; --bomb: #ffae00; --bg: #05070a; }
        * { touch-action: none; user-select: none; box-sizing: border-box; }
        body { margin: 0; background: var(--bg); font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        #gameWrapper { position: relative; width: 100%; max-width: 360px; height: 100vh; max-height: 640px; background: #000; border: 2px solid #1e293b; border-radius: 20px; overflow: hidden; box-shadow: 0 0 50px rgba(0,242,255,0.1); }
        canvas { display: block; width: 100%; height: 100%; }
        
        /* HUD Elements */
        .hud-stack { position: absolute; top: 15px; width: 100%; display: flex; flex-direction: column; align-items: center; pointer-events: none; z-index: 10; }
        .hi-score-label { color: #64748b; font-size: 9px; text-transform: uppercase; letter-spacing: 2px; }
        .hi-score-val { color: white; font-size: 14px; opacity: 0.7; margin-bottom: 2px; }
        .current-score-val { color: var(--primary); font-size: 32px; font-weight: 900; filter: drop-shadow(0 0 8px var(--primary)); }

        .life-bar { position: absolute; top: 90px; left: 0; width: 100%; text-align: center; color: var(--accent); font-size: 16px; z-index: 10; }
        .bomb-hud { position: absolute; bottom: 40px; width: 100%; text-align: center; color: var(--bomb); font-weight: 900; z-index: 10; font-size: 11px; letter-spacing: 1px; }

        .back-btn { position: absolute; top: 15px; left: 15px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); padding: 5px 12px; border-radius: 6px; font-size: 10px; z-index: 30; cursor: pointer; display: none; }

        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(5,7,10,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; text-align: center; color: white; padding: 20px; }
        .lvl-btn { width: 180px; padding: 14px; margin: 10px; border: 2px solid var(--primary); background: transparent; color: var(--primary); border-radius: 12px; font-weight: 800; cursor: pointer; text-transform: uppercase; transition: 0.2s; }
        
        #crosshair {
            position: absolute; width: 40px; height: 40px; border: 2px solid var(--bomb);
            border-radius: 50%; pointer-events: none; transform: translate(-50%, -50%);
            display: none; z-index: 100; box-shadow: 0 0 15px var(--bomb);
        }
    </style>
</head>
<body>

<div id="gameWrapper">
    <div id="crosshair"></div>
    <button id="backBtn" class="back-btn" onclick="goHome()">⬅ EXIT</button>

    <div class="hud-stack">
        <div class="hi-score-label">Global Best</div>
        <div id="best" class="hi-score-val">0</div>
        <div id="score" class="current-score-val">0</div>
    </div>
    
    <div id="lifeDisplay" class="life-bar">❤️❤️❤️❤️❤️</div>
    <div id="bombStatus" class="bomb-hud">WEAPONS SYSTEM: OFFLINE</div>
    
    <canvas id="gameCanvas" width="360" height="600"></canvas>
    
    <div id="menu" class="overlay">
        <h2 style="color: var(--primary); margin:0; font-size: 1rem;">ACE COMBAT</h2>
        <h1 style="color: #fff; font-size: 2.8rem; margin:0 0 20px 0; font-style: italic;">NEON STRIKE</h1>
        <button class="lvl-btn" onclick="startGame('noob')">Noob</button>
        <button class="lvl-btn" onclick="startGame('medium')">Medium</button>
        <button class="lvl-btn" onclick="startGame('pro')">Pro</button>
    </div>

    <div id="gameOver" class="overlay" style="display: none;">
        <h1 style="color: var(--accent); font-size: 2.5rem;">MISSION FAILED</h1>
        <p id="finalScore" style="font-size: 1.2rem; margin-bottom: 20px;"></p>
        <button class="lvl-btn" onclick="goHome()">Back to Base</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    const menu = document.getElementById('menu'), gameOver = document.getElementById('gameOver');
    const backBtn = document.getElementById('backBtn'), lifeDisplay = document.getElementById('lifeDisplay');
    const scoreText = document.getElementById('score'), bestText = document.getElementById('best');
    const bombStatus = document.getElementById('bombStatus'), crosshair = document.getElementById('crosshair');
    
    let gameActive = false, score = 0, frame = 0, lives = 5, currentDiff = 'medium';
    let hiScore = localStorage.getItem('strikeBest') || 0;
    bestText.innerText = hiScore;

    let player = { x: 180, y: 520, bombs: 1, nextBombScore: 500, invuln: 0 };
    let enemies = [], bullets = [], explosions = [], powerups = [];

    const diffSettings = {
        noob: { spawnRate: 70, enemySpeed: 1.8, shootRate: 20 },
        medium: { spawnRate: 50, enemySpeed: 3.5, shootRate: 15 },
        pro: { spawnRate: 35, enemySpeed: 5.5, shootRate: 12 }
    };

    // Drawing Logic
    function drawJet(x, y, color, isPlayer) {
        ctx.save(); ctx.translate(x, y);
        if (!isPlayer) ctx.rotate(Math.PI);
        ctx.strokeStyle = color; ctx.lineWidth = 2; ctx.shadowBlur = 10; ctx.shadowColor = color;
        ctx.beginPath();
        ctx.moveTo(0, -25); ctx.lineTo(-5, -15); ctx.lineTo(-5, 5);
        ctx.lineTo(-25, 10); ctx.lineTo(-25, 15); ctx.lineTo(-5, 10);
        ctx.lineTo(-5, 20); ctx.lineTo(-12, 25); ctx.lineTo(12, 25); ctx.lineTo(5, 20);
        ctx.lineTo(5, 10); ctx.lineTo(25, 15); ctx.lineTo(25, 10);
        ctx.lineTo(5, 5); ctx.lineTo(5, -15); ctx.closePath();
        ctx.stroke();
        if(isPlayer) { ctx.fillStyle = color; ctx.globalAlpha = 0.2; ctx.fill(); }
        ctx.restore();
    }

    // Audio Logic
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function beep(freq, type, dur, vol = 0.1) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + dur);
    }

    function goHome() { 
        gameActive = false; menu.style.display = 'flex'; gameOver.style.display = 'none'; 
        backBtn.style.display = 'none'; crosshair.style.display = 'none';
        document.body.style.cursor = 'default';
    }

    function startGame(difficulty) {
        currentDiff = difficulty;
        score = 0; lives = 5; frame = 0; enemies = []; bullets = []; powerups = [];
        player.bombs = 1; player.nextBombScore = 500;
        scoreText.innerText = '0';
        updateLifeUI(); updateBombUI();
        gameActive = true; menu.style.display = 'none'; backBtn.style.display = 'block';
        
        // Setup crosshair only for mouse users
        if(!('ontouchstart' in window)) {
            crosshair.style.display = 'block'; document.body.style.cursor = 'none';
        }
        loop();
    }

    function updateLifeUI() { lifeDisplay.innerText = "❤️".repeat(Math.max(0, lives)); }
    function updateBombUI() { 
        let controlHint = ('ontouchstart' in window) ? "DOUBLE TAP" : "SPACEBAR";
        bombStatus.innerText = player.bombs > 0 ? `SONIC BOMB: ${player.bombs} (${controlHint})` : `NEXT BOMB AT: ${player.nextBombScore}`;
        bombStatus.style.color = player.bombs > 0 ? 'var(--bomb)' : '#334155';
    }

    function handleDamage() {
        if(player.invuln > 0) return;
        lives--; player.invuln = 60;
        updateLifeUI(); beep(60, 'sawtooth', 0.3, 0.2);
        if(lives <= 0) endGame();
    }

    // --- INTEGRATED CONTROLS (MOUSE + TOUCH) ---
    function updatePlayerPos(clientX) {
        if(!gameActive) return;
        let rect = canvas.getBoundingClientRect();
        player.x = (clientX - rect.left) * (canvas.width / rect.width);
        if(player.x < 30) player.x = 30; if(player.x > 330) player.x = 330;
    }

    window.addEventListener('mousemove', e => {
        updatePlayerPos(e.clientX);
        crosshair.style.left = e.clientX + 'px';
        crosshair.style.top = e.clientY + 'px';
    });

    window.addEventListener('keydown', e => {
        if(e.code === 'Space' && gameActive) useSonicBomb();
    });

    let lastTap = 0;
    window.addEventListener('touchstart', e => {
        if(!gameActive) return;
        const now = Date.now();
        if(now - lastTap < 300) useSonicBomb();
        lastTap = now;
        updatePlayerPos(e.touches[0].clientX);
    });

    window.addEventListener('touchmove', e => {
        updatePlayerPos(e.touches[0].clientX);
    });

    // --- SONIC BOMB LOGIC ---
    function useSonicBomb() {
        if(!gameActive || player.bombs <= 0) return;
        player.bombs--; 
        updateBombUI();
        beep(50, 'sawtooth', 1.5, 0.4); 
        explosions.push({ x: 180, y: 300, r: 0, maxR: 900 });
        
        let killCount = enemies.length;
        enemies = []; // ACTUAL SCREEN CLEAR
        
        score += (killCount * 20);
        scoreText.innerText = score;
        checkBombMilestone();
    }

    function checkBombMilestone() {
        while (score >= player.nextBombScore) {
            player.bombs++;
            player.nextBombScore += 500;
            updateBombUI();
            beep(1200, 'sine', 0.3, 0.2);
        }
    }

    function loop() {
        if(!gameActive) return;
        frame++;
        const s = diffSettings[currentDiff];
        ctx.fillStyle = '#05070a'; ctx.fillRect(0, 0, 360, 600);

        if(player.invuln > 0) player.invuln--;

        // Firing Logic
        if(frame % s.shootRate === 0) {
            bullets.push({ x: player.x, y: player.y - 30 });
            beep(800, 'sine', 0.04, 0.02);
        }

        // Spawn Enemies
        if(frame % s.spawnRate === 0) {
            enemies.push({ x: Math.random() * 300 + 30, y: -40, s: s.enemySpeed });
        }

        // Draw Explosions
        explosions.forEach((ex, i) => {
            ex.r += 25;
            ctx.strokeStyle = '#fff'; ctx.lineWidth = 15; ctx.globalAlpha = 1 - (ex.r/ex.maxR);
            ctx.beginPath(); ctx.arc(ex.x, ex.y, ex.r, 0, Math.PI*2); ctx.stroke();
            ctx.globalAlpha = 1;
            if(ex.r > ex.maxR) explosions.splice(i, 1);
        });

        // Update Enemies
        enemies.forEach((e, ei) => {
            e.y += e.s;
            drawJet(e.x, e.y, '#ff3c00', false);
            bullets.forEach((b, bi) => {
                if(Math.abs(b.x - e.x) < 25 && Math.abs(b.y - e.y) < 25) {
                    enemies.splice(ei, 1); bullets.splice(bi, 1);
                    score += 10; scoreText.innerText = score;
                    checkBombMilestone();
                }
            });
            if(Math.abs(player.x - e.x) < 30 && Math.abs(player.y - e.y) < 30) {
                enemies.splice(ei, 1); handleDamage();
            }
            if(e.y > 640) { enemies.splice(ei, 1); handleDamage(); }
        });

        // Bullets
        bullets.forEach((b, bi) => {
            b.y -= 12; ctx.fillStyle = '#fff'; ctx.fillRect(b.x - 1, b.y, 2, 12);
            if(b.y < -20) bullets.splice(bi, 1);
        });

        if(player.invuln % 10 < 5) drawJet(player.x, player.y, '#00f2ff', true);
        requestAnimationFrame(loop);
    }

    function endGame() {
        gameActive = false;
        if(score > hiScore) localStorage.setItem('strikeBest', score);
        document.getElementById('finalScore').innerText = "Score: " + score;
        gameOver.style.display = 'flex';
        backBtn.style.display = 'none'; crosshair.style.display = 'none';
        document.body.style.cursor = 'default';
    }
</script>
</body>
</html>
